<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YaadVibe | Book Your Vibe</title>
  <link rel="icon" href="/1drop.png" />
  <script src="https://unpkg.com/@tonconnect/ui@1.0.0/dist/tonconnect-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode.js@1.0.0/lib/qrcode.min.js"></script>
  <style>
    :root {
      --gold: #FFD700; --red: #FF0000; --dark: #000; --green: #00FF00;
      --font: 'Arial', sans-serif;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: #000; color: #fff; font-family: var(--font);
      min-height: 100vh; display: flex; flex-direction: column;
      padding: 1rem; overflow-x: hidden;
    }
    .container { flex: 1; max-width: 480px; margin: 0 auto; }
    .logo { text-align:center; margin:1rem 0; }
    .logo img { height:60px; }
    h1 {
      font-size: 3.5rem; text-align:center; margin:1rem 0;
      background: linear-gradient(45deg, var(--red), var(--gold));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(255,215,0,0.6);
    }
    #progress {
      display:flex; justify-content:center; gap:0.8rem; margin:1.5rem 0;
      flex-wrap: wrap;
    }
    .prog-icon {
      width:36px; height:36px; border-radius:50%; background:rgba(255,255,255,0.15);
      display:flex; align-items:center; justify-content:center; font-size:0.9rem;
      transition: all 0.3s; position:relative;
    }
    .prog-icon svg { width:20px; height:20px; stroke: #fff; }
    .prog-icon.done { background:var(--green); }
    .prog-icon.done svg { stroke:#000; }
    .prog-icon.active { background:var(--gold); transform:scale(1.2); box-shadow:0 0 15px var(--gold); }
    .prog-icon.active svg { stroke:#000; }

    .step { display:none; padding:1.5rem 0; }
    .step.active { display:block; }
    .msg { text-align:center; font-size:1.3rem; margin:1rem 0; color:var(--gold); }
    .option-card {
      background:rgba(255,255,255,0.1); border-radius:12px; padding:1rem;
      margin:0.8rem 0; display:flex; align-items:center; gap:1rem;
      cursor:pointer; transition:0.3s; border:2px solid transparent;
    }
    .option-card img { width:60px; height:60px; object-fit:cover; border-radius:8px; }
    .option-card.selected { border-color:var(--gold); background:rgba(255,215,0,0.15); }
    .info .name { font-weight:700; font-size:1.1rem; }
    .info .price { color:var(--gold); font-weight:700; }
    .btn {
      width:100%; padding:1rem; margin:1rem 0; border:none; border-radius:12px;
      font-size:1.2rem; font-weight:700; cursor:pointer; transition:0.3s;
    }
    .btn.gold { background:var(--gold); color:#000; }
    .btn.green { background:var(--green); color:#000; }
    .btn.back {
      position:absolute; top:1rem; left:1rem; background:none; width:auto;
      padding:0.5rem; border-radius:50%;
    }
    .total {
      text-align:center; font-size:1.5rem; margin:1.5rem 0; color:var(--gold);
      padding:1rem; background:rgba(255,215,0,0.1); border-radius:12px;
    }
    .total.animate { animation: pulse 0.6s; }
    @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.05); } }
    .item { display:flex; justify-content:space-between; padding:0.9rem 0; border-bottom:1px solid rgba(255,255,255,0.25); font-size:1.1rem; }
    input, select { width:100%; padding:1rem; margin:0.5rem 0; border-radius:12px; border:none; background:rgba(255,255,255,0.1); color:#fff; font-size:1.1rem; }
    #liveTotal { font-weight:700; color:var(--gold); }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo"><img src="/1drop.png" alt="1Drop"></div>
    <h1>YAAD<br>VIBE</h1>
    <div id="progress"></div>
    <div class="total">Total: $<span id="liveTotal">0.00</span></div>

    <!-- STEP 0: START -->
    <div id="step0" class="step active">
      <p class="msg">Ready fi di Yaad?</p>
      <button class="btn gold" id="startBtn">Start Booking</button>
    </div>

    <!-- STEP 1: LOCAL OR VISITOR -->
    <div id="step1" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">You from Jamaica?</p>
      <div class="option-card" data-value="yes"><div class="info"><div class="name">Yes, local</div></div></div>
      <div class="option-card" data-value="no"><div class="info"><div class="name">No, coming in</div></div></div>
    </div>

    <!-- STEP 2: FROM CITY -->
    <div id="step2" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Where you flying from?</p>
      <input type="text" id="fromCity" placeholder="e.g. New York, Miami" />
      <button class="btn gold" id="btn2">Next</button>
    </div>

    <!-- STEP 2.5: FLIGHTS -->
    <div id="step25" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Choose Flight</p>
      <div id="flight-options"></div>
      <div class="option-card" data-flight="skip"><div class="info"><div class="name">Skip (I’ll book later)</div></div></div>
      <button class="btn gold" id="btnFlight">Next</button>
    </div>

    <!-- STEP 3: DATES -->
    <div id="step3" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Arrival & Departure</p>
      <input type="date" id="arriveDate" />
      <input type="date" id="departDate" />
      <p>Nights: <span id="nightCount">1</span></p>
      <button id="minus" class="btn" style="width:auto;display:inline-block;">-</button>
      <button id="plus" class="btn" style="width:auto;display:inline-block;">+</button>
      <p>Adults: <input type="number" id="adults" value="2" min="1" style="width:60px;display:inline-block;" /></p>
      <p>Kids: <input type="number" id="kids" value="0" min="0" style="width:60px;display:inline-block;" /></p>
      <button class="btn gold" id="btn3">Next</button>
    </div>

    <!-- STEP 4: PARISH -->
    <div id="step4" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Which Parish?</p>
      <div id="parish-options"></div>
      <button class="btn gold" id="parishNext" style="display:none;">Next</button>
    </div>

    <!-- STEP 5: VIBE -->
    <div id="step5" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Coastal or Inland?</p>
      <div class="option-card" data-value="coastal"><div class="info"><div class="name">Coastal</div></div></div>
      <div class="option-card" data-value="inland"><div class="info"><div class="name">Inland</div></div></div>
      <button class="btn gold" id="btnVibe">Next</button>
    </div>

    <!-- STEP 6: STAY -->
    <div id="step6" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Choose Your Stay</p>
      <div id="stay-options"></div>
      <button class="btn gold" id="btnStay">Next</button>
    </div>

    <!-- STEP 7: TRANSPORT -->
    <div id="step7" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Add Transport</p>
      <div id="transport-options"></div>
      <button class="btn gold" id="btnTransport">Next</button>
    </div>

    <!-- STEP 8: TOURS -->
    <div id="step8" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Add Tours (Optional)</p>
      <div id="tour-options"></div>
      <button class="btn gold" id="btnTours">Show My Package</button>
    </div>

    <!-- SUMMARY -->
    <div id="summary" class="step">
      <button class="btn back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <p class="msg">Your YaadVibe Package</p>
      <div id="summary-items" style="margin:1.5rem 0;"></div>
      <div class="total">Total: $<span id="total">0.00</span></div>
      <button class="btn gold" id="btnPay" style="margin:1.2rem 0; display:none;">Pay with TON Wallet</button>
      <button class="btn green" id="btnTip" style="margin:0.8rem 0; font-size:1.2rem; padding:1rem; display:none;">
        <span style="font-size:1.4rem;">Tip</span> the Vibe $5
      </button>
      <div id="qr-area" style="margin:2.2rem 0; text-align:center;"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const PARISH_TOWNS = {
        "clarendon": "May Pen", "hanover": "Lucea", "kingston": "Kingston", "manchester": "Mandeville",
        "portland": "Port Antonio", "saint-andrew": "Half Way Tree", "saint-ann": "St. Ann’s Bay",
        "saint-catherine": "Spanish Town", "saint-elizabeth": "Black River", "saint-james": "Montego Bay",
        "saint-mary": "Port Maria", "saint-thomas": "Morant Bay", "trelawny": "Falmouth",
        "westmoreland": "Savanna-la-Mar"
      };
      const ALL_PARISHES = Object.keys(PARISH_TOWNS);

      const LIVE_DATA = {
        flights: { default: [
          { airline: "JetBlue", code: "B6231", price: 380, arrive: "2025-12-01", depart: "2025-12-08" },
          { airline: "American", code: "AA1347", price: 420, arrive: "2025-12-02", depart: "2025-12-09" }
        ]},
        accommodations: { default: [
          { name: "Sandals Montego Bay", price: 320, img: "/sandals.jpg", type: "coastal" },
          { name: "Jakes Hotel", price: 280, img: "/jakes.jpg", type: "coastal" },
          { name: "Ian Fleming Villas", price: 450, img: "/ian.jpg", type: "inland" }
        ]},
        transport: { default: [
          { name: "Private Transfer (MBJ → Hotel)", price: 80 },
          { name: "Knutsford Express", price: 35 }
        ]},
        tours: { default: [
          { name: "Dunn’s River Climb", price: 65 },
          { name: "Blue Hole Secret Falls", price: 55 }
        ]}
      };

      let state = { from:'', arrive:'', depart:'', parish:'', vibe:'', stay:null, transport:[], tours:[], nights:1, adults:2, kids:0, isLocal:false, flight:null };
      let total = 0;
      let tonConnectUI;
      let currentStep = 0;

      try {
        tonConnectUI = new window.TonConnectUI({
          manifestUrl: 'https://yaadvibe.com/tonconnect-manifest.json',
          buttonRootId: null
        });
      } catch(e) { console.warn("TON Connect not loaded"); }

      const updateCalc = (animate = false) => {
        const prevTotal = total;
        total = 0;
        if (state.stay) {
          const base = state.stay.price * state.nights;
          const occupancyFee = state.adults > 2 ? (state.adults - 2) * 50 : 0;
          total += base + occupancyFee + Math.round(base * 0.05);
        }
        state.transport.forEach(t => total += t.price);
        state.tours.forEach(t => total += t.price);
        if (state.flight) total += state.flight.price;

        const el = document.getElementById('liveTotal');
        el.textContent = total.toFixed(2);
        if (animate && total !== prevTotal) {
          el.parentElement.classList.add('animate');
          setTimeout(() => el.parentElement.classList.remove('animate'), 600);
        }
      };

      const calcNightsFromDates = () => {
        const arrive = document.getElementById('arriveDate').value;
        const depart = document.getElementById('departDate').value;
        if (arrive && depart) {
          const diff = (new Date(depart) - new Date(arrive)) / 86400000;
          if (diff > 0) {
            state.nights = diff;
            document.getElementById('nightCount').textContent = diff;
            updateCalc(true);
          }
        }
      };

      const next = (n) => {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        const stepId = n === 2.5 ? 'step25' : n === 9 ? 'summary' : `step${n}`;
        const step = document.getElementById(stepId);
        if (step) step.classList.add('active');
        currentStep = n;
        updateProgress();
      };

      const back = () => {
        const steps = [0,1,2,2.5,3,4,5,6,7,8,9];
        const idx = steps.indexOf(currentStep);
        if (idx > 0) next(steps[idx - 1]);
      };

      const updateProgress = () => {
        const icons = document.getElementById('progress');
        icons.innerHTML = '';
        const svgs = [
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 5h12l-1 4H6l-3-4z"/><path d="M3 9h12l-1 4H6l-3-4z"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.8 19.2L16 11l-5-1-1-5-3 1 1 5-5 1 1.8 8.2"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12s3-5.5 9-5.5S21 12 21 12s-3 5.5-9 5.5S3 12 3 12z"/><circle cx="12" cy="12" r="3"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/><path d="M16 3v4M8 3v4"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><path d="M9 9h.01M15 9h.01"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`,
          `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M7 8h10M7 12h7m-7 4h4"/></svg>`
        ];
        svgs.forEach((svg, i) => {
          const el = document.createElement('div');
          el.className = 'prog-icon';
          el.innerHTML = svg;
          if (i < currentStep) el.classList.add('done');
          if (i === currentStep) el.classList.add('active');
          icons.appendChild(el);
        });
      };

      const renderParishes = () => {
        const c = document.getElementById('parish-options'); c.innerHTML = '';
        ALL_PARISHES.forEach(p => {
          const display = `${p.replace(/-/g,' ').replace(/\b\w/g, l => l.toUpperCase())} (${PARISH_TOWNS[p]})`;
          const card = document.createElement('div');
          card.className = 'option-card';
          card.innerHTML = `<div class="info"><div class="name">${display}</div></div>`;
          card.onclick = () => {
            c.querySelectorAll('.option-card').forEach(x => x.classList.remove('selected'));
            card.classList.add('selected');
            state.parish = p;
            document.getElementById('parishNext').style.display = 'block';
          };
          c.appendChild(card);
        });
      };

      const loadStays = () => {
        const c = document.getElementById('stay-options');
        c.innerHTML = '<p style="text-align:center;color:#aaa">Finding your vibe...</p>';
        setTimeout(() => {
          c.innerHTML = '';
          const items = LIVE_DATA.accommodations[state.parish] || LIVE_DATA.accommodations.default;
          const filtered = state.vibe ? items.filter(i => i.type === state.vibe) : items;
          filtered.forEach(item => {
            const card = document.createElement('div');
            card.className = 'option-card';
            card.innerHTML = `
              <img src="${item.img}" onerror="this.src='/IMG_0039.jpeg'" alt="${item.name}">
              <div class="info">
                <div class="name">${item.name}</div>
                <div class="price">$${item.price}/night</div>
              </div>
            `;
            card.onclick = () => {
              c.querySelectorAll('.option-card').forEach(x => x.classList.remove('selected'));
              card.classList.add('selected');
              state.stay = {...item};
              updateCalc(true);
            };
            c.appendChild(card);
          });
        }, 600);
      };

      const loadTransport = () => {
        const c = document.getElementById('transport-options'); c.innerHTML = '';
        const opts = LIVE_DATA.transport[state.parish] || LIVE_DATA.transport.default;
        opts.forEach(t => {
          const card = document.createElement('div');
          card.className = 'option-card';
          card.innerHTML = `<div class="info"><div class="name">${t.name}</div><div class="price">$${t.price}</div></div>`;
          card.onclick = () => {
            card.classList.toggle('selected');
            if (card.classList.contains('selected')) state.transport.push(t);
            else state.transport = state.transport.filter(x => x.name !== t.name);
            updateCalc(true);
          };
          c.appendChild(card);
        });
      };

      const loadTours = () => {
        const c = document.getElementById('tour-options'); c.innerHTML = '';
        const opts = LIVE_DATA.tours[state.parish] || LIVE_DATA.tours.default;
        opts.forEach(t => {
          const card = document.createElement('div');
          card.className = 'option-card';
          card.innerHTML = `<div class="info"><div class="name">${t.name}</div><div class="price">$${t.price}</div></div>`;
          card.onclick = () => {
            card.classList.toggle('selected');
            if (card.classList.contains('selected')) state.tours.push(t);
            else state.tours = state.tours.filter(x => x.name !== t.name);
            updateCalc(true);
          };
          c.appendChild(card);
        });
      };

      const loadFlights = () => {
        const c = document.getElementById('flight-options'); c.innerHTML = '';
        const opts = LIVE_DATA.flights[state.from] || LIVE_DATA.flights.default;
        opts.forEach(f => {
          const card = document.createElement('div');
          card.className = 'option-card';
          card.innerHTML = `
            <div class="info">
              <div class="name">${f.airline} • ${f.code}</div>
              <div class="price">$${f.price} roundtrip</div>
            </div>
          `;
          card.onclick = () => {
            document.querySelectorAll('#flight-options .option-card').forEach(x => x.classList.remove('selected'));
            card.classList.add('selected');
            state.flight = f;
          };
          c.appendChild(card);
        });
      };

      const showSummary = () => {
        setTimeout(() => {
          const div = document.getElementById('summary-items');
          if (!div) return;
          div.innerHTML = '';
          const add = (label, price, fee = 0) => {
            div.innerHTML += `
              <div class="item">
                <span>${label}</span>
                <span style="color:#FFD700;font-weight:700;">$${price}${fee ? ` + <strong>$${fee}</strong>` : ''}</span>
              </div>`;
          };
          if (state.stay) {
            const base = state.stay.price * state.nights;
            const occupancyFee = state.adults > 2 ? (state.adults - 2) * 50 : 0;
            const serviceFee = Math.round(base * 0.05);
            add(`${state.stay.name} (${state.nights} night${state.nights>1?'s':''})`, base + occupancyFee, serviceFee);
          }
          state.transport.forEach(t => add(t.name, t.price));
          state.tours.forEach(t => add(t.name, t.price));
          if (state.flight) add(`${state.flight.airline} Flight (Roundtrip)`, state.flight.price);
          document.getElementById('total').textContent = total.toFixed(2);
          next(9);
          document.getElementById('btnPay').style.display = 'block';
          document.getElementById('btnTip').style.display = 'block';
        }, 150);
      };

      document.getElementById('btnPay').onclick = async () => {
        if (total === 0) return alert("Add items first!");
        if (!tonConnectUI) return alert("TON Wallet not available");

        const finalTotal = total;
        const payload = { ...state, total: finalTotal };

        try {
          const tx = {
            validUntil: Math.floor(Date.now() / 1000) + 300,
            messages: [{
              address: "EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM9c",
              amount: String(Math.round(finalTotal * 1e9)),
              payload: btoa(JSON.stringify(payload))
            }]
          };
          const result = await tonConnectUI.sendTransaction(tx);
          alert(`Payment sent! Total: $${finalTotal.toFixed(2)}\nTx: ${result.boc}`);
          new QRCode(document.getElementById("qr-area"), {
            text: result.boc, width: 240, height: 240,
            colorDark: "#FFD700", colorLight: "#000"
          });
        } catch (e) {
          alert("Payment failed: " + e.message);
        }
      };

      document.getElementById('btnTip').onclick = async () => {
        if (!tonConnectUI) return alert("TON Wallet not available");
        try {
          const tx = {
            validUntil: Math.floor(Date.now() / 1000) + 300,
            messages: [{
              address: "EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM9c",
              amount: "5000000000",
              payload: btoa(JSON.stringify({ tip: true, from: state.from || "local" }))
            }]
          };
          const result = await tonConnectUI.sendTransaction(tx);
          alert("Tip sent! Bless up!");
          new QRCode(document.getElementById("qr-area"), {
            text: result.boc, width: 200, height: 200,
            colorDark: "#FFD700", colorLight: "#000"
          });
        } catch (e) {
          alert("Tip failed: " + e.message);
        }
      };

      // === EVENT LISTENERS ===
      document.getElementById('startBtn').onclick = () => next(1);
      document.getElementById('step1').onclick = e => {
        const card = e.target.closest('.option-card');
        if (card) {
          document.querySelectorAll('#step1 .option-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          state.isLocal = card.dataset.value === 'yes';
          next(2);
        }
      };
      document.getElementById('btn2').onclick = () => {
        state.from = document.getElementById('fromCity').value.trim();
        if (!state.from) return alert("Enter city!");
        if (!state.isLocal) { loadFlights(); next(2.5); } else next(3);
      };
      document.getElementById('step25').onclick = e => {
        const card = e.target.closest('.option-card');
        if (card && card.dataset.flight === 'skip') {
          document.querySelectorAll('#step25 .option-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          state.flight = null;
        }
      };
      document.getElementById('btnFlight').onclick = () => {
        if (state.flight) {
          document.getElementById('arriveDate').value = state.flight.arrive;
          document.getElementById('departDate').value = state.flight.depart;
          calcNightsFromDates();
        }
        next(3);
      };
      ['adults','kids'].forEach(id => {
        document.getElementById(id).onchange = e => { state[id] = +e.target.value; updateCalc(true); };
      });
      document.getElementById('minus').onclick = () => { if (state.nights > 1) { state.nights--; document.getElementById('nightCount').textContent = state.nights; updateCalc(true); } };
      document.getElementById('plus').onclick = () => { state.nights++; document.getElementById('nightCount').textContent = state.nights; updateCalc(true); };
      document.getElementById('departDate').onchange = calcNightsFromDates;
      document.getElementById('btn3').onclick = () => {
        state.arrive = document.getElementById('arriveDate').value;
        state.depart = document.getElementById('departDate').value;
        if (!state.arrive || !state.depart) return alert("Pick both dates!");
        next(4);
        renderParishes();
      };
      document.getElementById('parishNext').onclick = () => {
        if (!state.parish) return alert("Choose parish!");
        next(5);
      };
      document.getElementById('btnVibe').onclick = () => {
        const sel = document.querySelector('#step5 .option-card.selected');
        if (!sel) return alert("Choose vibe!");
        state.vibe = sel.dataset.value;
        loadStays();
        next(6);
      };
      document.getElementById('btnStay').onclick = () => {
        if (!state.stay) return alert("Pick stay!");
        loadTransport();
        next(7);
      };
      document.getElementById('btnTransport').onclick = () => { loadTours(); next(8); };
      document.getElementById('btnTours').onclick = showSummary;

      document.querySelectorAll('.btn.back').forEach(btn => {
        btn.onclick = (e) => { e.stopPropagation(); back(); };
      });

      updateProgress();
    });
  </script>
</body>
</html>
