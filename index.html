<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>1Drop YaadVibe</title>
  <!-- WalletConnect -->
  <script src="https://unpkg.com/@walletconnect/modal@2"></script>
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <style>
    :root { --gold: #FFD700; --green: #009B48; --dark: #0a0a0a; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: url('https://images.unsplash.com/photo-1506929562872-bb421503ef21?w=1200') center/cover no-repeat fixed;
      color: #fff; font-family: -apple-system, system-ui, sans-serif;
      min-height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
    }
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.74); backdrop-filter: blur(3px); }
    .c { position: relative; z-index: 2; flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; padding: 2rem 1rem; text-align: center;
      max-width: 420px; margin: 0 auto; width: 100%; gap: 1.8rem;
    }
    h1 {
      font-size: clamp(6rem, 16vw, 12rem); font-weight: 900;
      background: linear-gradient(45deg, #fff, var(--gold), #FFEDAB);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      line-height: 0.88; letter-spacing: -3px;
    }
    .msg { font-size: 1.9rem; font-weight: 700; line-height: 1.4; max-width: 90%; opacity: 0.98; }
    .btn {
      width: 88dvw; max-width: 380px; padding: 1.9rem; border-radius: 30px;
      font-size: 2rem; font-weight: 900; border: none; cursor: pointer;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8); transition: all .3s;
      opacity: 0; transform: translateY(20px);
    }
    .btn.visible { opacity: 1; transform: none; }
    .gold { background: var(--gold); color: #000; }
    .dark { background: var(--dark); color: var(--gold); border: 4px solid var(--gold); }
    .green { background: var(--green); color: #fff; border: 6px solid var(--gold);
      box-shadow: 0 0 40px rgba(255,215,0,0.7); animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{box-shadow:0 0 40px rgba(255,215,0,0.7)} 50%{box-shadow:0 0 60px rgba(255,215,0,1)} }
    .btn:active { transform: scale(0.94); }
    .lynk { color: var(--gold); font-size: 1.4rem; font-weight: 700; opacity: 0.9; }

    #journey { margin: 2rem 0; width: 100%; max-height: 50vh; overflow-y: auto; padding: 0 1rem; }
    .stay {
      background: var(--green); border: 5px solid var(--gold); padding: 1.4rem;
      margin: 1rem; border-radius: 20px; overflow: hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7); animation: slide 0.6s ease-out;
      cursor: pointer;
    }
    @keyframes slide { from { transform: translateY(40px); opacity: 0; } to { transform: none; opacity: 1; } }
    .stay img { width: 100%; height: 180px; object-fit: cover; border-radius: 16px; margin-bottom: 10px; }
    .stay.selected { border-color: #fff; box-shadow: 0 0 30px #fff; }
    .loading { font-size: 1.5rem; color: var(--gold); animation: blink 1.5s infinite; text-align: center; }
    @keyframes blink { 0%,100%{opacity:0.4} 50%{opacity:1} }

    .calc-panel {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(0,155,72,0.98); border-top: 5px solid var(--gold);
      padding: 1.2rem; border-radius: 36px 36px 0 0; z-index: 30;
      transform: translateY(100%); transition: transform .4s cubic-bezier(0.23,1,0.32,1);
    }
    .calc-panel.active { transform: translateY(0); }
    .close { position: absolute; top: 10px; right: 14px; font-size: 2.6rem;
      background: none; border: none; color: #fff; cursor: pointer; }
    .num { width: 58px; height: 58px; line-height: 58px; font-size: 2rem;
      background: var(--dark); color: var(--gold); border-radius: 50%;
      margin: 0 10px; font-weight: 900; text-align: center; }
    .calc-row { font-size: 1.3rem; line-height: 2.8; display: flex;
      align-items: center; justify-content: center; margin: 0.6rem 0; }
    .calc-row select, input[type="date"] {
      font-size: 1.3rem; padding: 10px; border-radius: 12px;
      background: var(--dark); color: var(--gold); margin-top: 8px; width: 80%;
    }
    .qr-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; margin-top: 20px; }
    .qr-item { background: #fff; padding: 8px; border-radius: 12px; text-align: center; }
    .qr-item p { color: #000; font-size: 0.8rem; margin-top: 4px; }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="c">
    <h1>YAAD<br>VIBE</h1>
    <p class="msg" id="message">Mi 1Drop — mi can help book your Jamaican vacation?<br>When yuh reachin?</p>
    <div id="journey"></div>
    <button id="mainBtn" class="btn gold visible">Pick Date</button>
    <button id="mintBtn" class="btn dark">Konnet Wallet + Mint SBT</button>
    <div class="lynk">Instant payout Jamaica Lynk @Rootsraddik</div>
  </div>

  <!-- CALCULATOR PANEL -->
  <div id="calcPanel" class="calc-panel">
    <button class="close" onclick="closeCalc()">X</button>
    <h3 style="font-size:1.8rem;margin-bottom:1rem;text-align:center">Party Details</h3>
    <div class="calc-row">Big People − <button onclick="adj('a',-1)">−</button> <b id="a" class="num">1</b> <button onclick="adj('a',1)">+</button></div>
    <div class="calc-row">Pickney − <button onclick="adj('c',-1)">−</button> <b id="c" class="num">0</b> <button onclick="adj('c',1)">+</button></div>
    <div class="calc-row">Baby − <button onclick="adj('i',-1)">−</button> <b id="i" class="num">0</b> <button onclick="adj('i',1)">+</button></div>
    <div class="calc-row">
      <select id="pets"><option>No</option><option>Dog</option><option>Cat</option><option>Both</option></select>
    </div>
    <button class="btn gold" style="margin-top:1.5rem;font-size:1.6rem;padding:1.4rem;width:80%" onclick="saveParty()">LOCK IN</button>
  </div>

  <script type="module">
    const msg = document.getElementById("message");
    const mainBtn = document.getElementById("mainBtn");
    const mintBtn = document.getElementById("mintBtn");
    const journey = document.getElementById("journey");
    const calcPanel = document.getElementById("calcPanel");

    let step = 0;
    let data = { date: "", adults: 1, kids: 0, babies: 0, pets: "No", parish: "", vibe: "", stay: null, transport: [], tours: [] };

    // LIVE METADATA (Replace with API later)
    const PARISHES = ["Kingston", "St. Andrew", "Portland", "St. Mary", "St. Ann", "Trelawny", "St. James", "Hanover", "Westmoreland", "St. Elizabeth", "Manchester", "Clarendon", "St. Catherine", "St. Thomas"];
    const STAYS = {
      "st-james": [
        { name: "Round Hill • Villa 10", price: 680, img: "https://www.roundhill.com/wp-content/uploads/2023/06/Round-Hill-Villa-Exterior.jpg", type: "coastal" },
        { name: "Iberostar Rose Hall", price: 420, img: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/2a/2d/3f/2c/goldeneye.jpg?w=1200", type: "coastal" }
      ],
      "kingston": [
        { name: "Jewel Grande • Moonrise", price: 580, img: "https://cf.bstatic.com/xdata/images/hotel/max1280x900/483221417.jpg", type: "coastal" },
        { name: "Pegasus Suite", price: 480, img: "https://cf.bstatic.com/xdata/images/hotel/max1280x900/483221417.jpg", type: "inland" }
      ]
    };

    function showLoading() {
      const l = document.createElement("div"); l.className = "loading"; l.textContent = "Wah gwaan... mi a check";
      journey.appendChild(l); setTimeout(() => l.remove(), 1200);
    }

    function addStay(item) {
      const div = document.createElement("div");
      div.className = "stay";
      div.innerHTML = `<img src="${item.img}" alt="${item.name}">
        <div style="font-weight:900;font-size:1.5rem;margin-top:8px">
          ${item.name}<br><span style="color:var(--gold);font-size:1.8rem">$${item.price}/night</span>
        </div>`;
      div.onclick = () => {
        journey.querySelectorAll('.stay').forEach(s => s.classList.remove('selected'));
        div.classList.add('selected');
        data.stay = item;
      };
      journey.appendChild(div);
    }

    function calcTotal() {
      let total = 0;
      if (data.stay) total += data.stay.price * 3; // 3 nights default
      data.transport.forEach(t => total += t.price);
      data.tours.forEach(t => total += t.price);
      return total;
    }

    function next(text, btnText = "Next", btnClass = "gold") {
      msg.innerHTML = text;
      mainBtn.textContent = btnText;
      mainBtn.className = `btn ${btnClass} visible`;
      mintBtn.style.display = "none";
    }

    function openCalc() { calcPanel.classList.add("active"); }
    function closeCalc() { calcPanel.classList.remove("active"); }

    function adj(type, delta) {
      const min = type === 'a' ? 1 : 0;
      if (data[type] + delta >= min) {
        data[type] += delta;
        document.getElementById(type).textContent = data[type];
      }
    }

    function saveParty() {
      data.pets = document.getElementById("pets").value;
      closeCalc();
      next("Yuh comin from abroad?", "Yes", "gold");
      step = 2;
    }

    mainBtn.onclick = () => {
      step++;
      showLoading();
      setTimeout(() => {
        if (step === 1) {
          const input = document.createElement("input"); input.type = "date"; input.style = "font-size:1.6rem;padding:12px;border-radius:12px;background:var(--dark);color:var(--gold);width:80%;margin-top:1rem";
          input.onchange = (e) => { data.date = e.target.value; next("Yuh comin alone or wid company?", "Open Party Calculator"); mainBtn.onclick = openCalc; };
          msg.appendChild(input); input.focus();
        }
        else if (step === 3) {
          next("Which parish yuh waan stay?", "Choose Parish");
          PARISHES.forEach(p => {
            const btn = document.createElement("div"); btn.className = "stay";
            btn.innerHTML = `<div style="font-weight:900;font-size:1.6rem">${p}</div>`;
            btn.onclick = () => { data.parish = p.toLowerCase().replace(/ /g, '-'); next("Coastal or Inland vibe?", "Coastal"); };
            journey.appendChild(btn);
          });
        }
        else if (step === 4) {
          const coastal = document.createElement("div"); coastal.className = "stay"; coastal.textContent = "Coastal"; coastal.onclick = () => { data.vibe = "coastal"; loadStays(); };
          const inland = document.createElement("div"); inland.className = "stay"; inland.textContent = "Inland"; inland.onclick = () => { data.vibe = "inland"; loadStays(); };
          journey.appendChild(coastal); journey.appendChild(inland);
        }
      }, 800);
    };

    function loadStays() {
      journey.innerHTML = '<div class="loading">Finding your vibe...</div>';
      setTimeout(() => {
        journey.innerHTML = '';
        const stays = STAYS[data.parish] || [];
        const filtered = data.vibe ? stays.filter(s => s.type === data.vibe) : stays;
        filtered.forEach(addStay);
        next("Choose your stay", "Confirm Stay");
        mainBtn.onclick = () => { if (data.stay) next("Need transport?", "Yes"); };
      }, 1000);
    }

    // MINT SBT
    mintBtn.onclick = async () => {
      const total = calcTotal();
      if (!data.stay) return alert("Choose a stay first!");
      
      const sbt = { id: Date.now(), user: `YaadUser-${Math.random().toString(36).substr(2,6)}`, package: data, total, timestamp: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(sbt, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `yaadlife-sbt-${sbt.id}.json`; a.click();

      journey.innerHTML = '<h3 style="color:var(--gold)">SBT Minted!</h3><div class="qr-grid"></div>';
      ["Stay", "Transport", "Total"].forEach(txt => {
        const div = document.createElement('div'); div.className = 'qr-item';
        const qr = document.createElement('div'); new QRCode(qr, {text: txt, width: 100, height: 100});
        div.appendChild(qr); const p = document.createElement('p'); p.textContent = txt; div.appendChild(p);
        journey.querySelector('.qr-grid').appendChild(div);
      });
    };
  </script>
</body>
</html>
