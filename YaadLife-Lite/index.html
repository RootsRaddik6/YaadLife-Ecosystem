<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YaadLife Lite – Build Your Jamaica Package</title>
  <script src="mock-data.js"></script>
  <script src="qrcode.min.js"></script>
  <style>
    body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:20px;color:#333}
    .container{max-width:800px;margin:auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    h1,h2{margin-top:0}
    .step{margin:30px 0;display:none}
    .step.active{display:block}
    select,button,input{padding:10px;margin:5px 0;width:100%;font-size:16px}
    button{background:#28a745;color:#fff;border:none;cursor:pointer}
    button:hover{background:#218838}
    .summary{margin-top:20px;padding:15px;background:#e9ecef;border-radius:5px}
    .item{display:flex;justify-content:space-between;margin:8px 0}
    .fee{color:#28a745;font-weight:bold}
    .qr{margin-top:10px}
    .hero img{max-width:100%;border-radius:8px}
  </style>
</head>
<body>
<div class="container">

  <div class="hero"><img src="IMG_0039.jpg" alt="Jamaica Vibes"></div>

  <!-- ==== STEP 0 – Opening Question ==== -->
  <div id="step0" class="step active">
    <h1>How can we help you book your vacation package?</h1>
    <button onclick="nextStep(1)">Start Building</button>
  </div>

  <!-- ==== STEP 1 – Travel To Jamaica? ==== -->
  <div id="step1" class="step">
    <h2>Are you traveling to Jamaica?</h2>
    <select onchange="this.value&&nextStep(2)">
      <option value="">Select…</option>
      <option value="yes">Yes</option>
      <option value="no">No (local resident)</option>
    </select>
  </div>

  <!-- ==== STEP 2 – From Where? ==== -->
  <div id="step2" class="step">
    <h2>Where are you traveling from?</h2>
    <input type="text" placeholder="City, Country" id="from">
    <button onclick="nextStep(3)">Next</button>
  </div>

  <!-- ==== STEP 3 – When? ==== -->
  <div id="step3" class="step">
    <h2>When do you plan to arrive?</h2>
    <input type="date" id="arrive">
    <button onclick="nextStep(4)">Next</button>
  </div>

  <!-- ==== STEP 4 – Parish ==== -->
  <div id="step4" class="step">
    <h2>Which parish will you stay in?</h2>
    <select id="parish" onchange="loadAccommodationOptions()"></select>
    <button onclick="nextStep(5)">Next</button>
  </div>

  <!-- ==== STEP 5 – Inland / Coastal ==== -->
  <div id="step5" class="step">
    <h2>Inland or Coastal vibe?</h2>
    <select id="vibe" onchange="filterAccommodations()">
      <option value="">Any</option>
      <option value="inland">Inland</option>
      <option value="coastal">Coastal</option>
    </select>
  </div>

  <!-- ==== STEP 6 – Accommodation Choices ==== -->
  <div id="step6" class="step">
    <h2>Choose your stay</h2>
    <div id="accommodation-list"></div>
    <button onclick="nextStep(7)">Next → Transport</button>
  </div>

  <!-- ==== STEP 7 – Transport ==== -->
  <div id="step7" class="step">
    <h2>Need transportation?</h2>
    <select id="needTransport" onchange="toggleTransport(this.value)">
      <option value="no">No</option>
      <option value="yes">Yes</option>
    </select>
    <div id="transport-options" style="display:none;margin-top:10px"></div>
    <button onclick="nextStep(8)">Next → Tours</button>
  </div>

  <!-- ==== STEP 8 – Tours / Attractions ==== -->
  <div id="step8" class="step">
    <h2>Add tours or attractions (optional)</h2>
    <div id="tour-list"></div>
    <button onclick="showSummary()">Show My Package</button>
  </div>

  <!-- ==== FINAL SUMMARY ==== -->
  <div id="summary" class="step">
    <h2>Your YaadLife Package</h2>
    <div id="package-items"></div>
    <div class="summary"><strong>Total:</strong> <span id="total">0</span> USD</div>
    <button onclick="payNow()">Pay & Generate SBT / QR</button>
    <div id="qr-area" style="margin-top:20px"></div>
  </div>

</div>

<script>
/* ---------- GLOBAL STATE ---------- */
const state = {
  from: '', arrive: '', parish: '', vibe: '',
  stay: null, transport: [], tours: []
};

/* ---------- PARISH LIST ---------- */
const parishes = [
  "kingston","st-andrew","st-thomas","portland","st-mary","st-ann",
  "trelawny","st-james","hanover","westmoreland","st-elizabeth",
  "manchester","clarendon","st-catherine"
];
const parishSelect = document.getElementById('parish');
parishes.forEach(p=>{
  const opt = document.createElement('option');
  opt.value = p; opt.textContent = p.replace(/-/g,' ').toUpperCase();
  parishSelect.appendChild(opt);
});

/* ---------- NAVIGATION ---------- */
function nextStep(n){
  console.log('Switching to step ' + n); // For later
  alert('Debug: Moving to Step ' + n); // iPhone-visible
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  const target = document.getElementById('step'+n);
  if (target) {
    target.classList.add('active');
  } else {
    alert('Error: Step ' + n + ' not found!');
  }
}
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  document.getElementById('step'+n).classList.add('active');
}
function showSummary(){
  renderSummary();
  nextStep(9); // summary is step 9 (id="summary")
}

/* ---------- STEP 2 – FROM ---------- */
document.querySelector('#step2 button').onclick = ()=>{
  state.from = document.getElementById('from').value.trim();
};

/* ---------- STEP 3 – ARRIVE ---------- */
document.querySelector('#step3 button').onclick = ()=>{
  state.arrive = document.getElementById('arrive').value;
};

/* ---------- STEP 4 – PARISH ---------- */
function loadAccommodationOptions(){
  state.parish = document.getElementById('parish').value;
  filterAccommodations(); // will also be called by vibe
}

/* ---------- STEP 5 – VIBE & ACCOMMODATION LIST ---------- */
function filterAccommodations(){
  const vibe = document.getElementById('vibe').value;
  state.vibe = vibe;
  const listDiv = document.getElementById('accommodation-list');
  listDiv.innerHTML = '';
  const items = MOCK.accommodations[state.parish] || [];
  const filtered = vibe ? items.filter(i=>i.type===vibe) : items;
  filtered.forEach((item,idx)=>{
    const div = document.createElement('div');
    div.className = 'item';
    const fee = item.price * 0.05;
    div.innerHTML = `
      <span>${item.name} (${item.source}) – $${item.price} 
        ${item.local?'<i>(local)</i>':''}
      </span>
      <button data-idx="${idx}">Select</button>
    `;
    div.querySelector('button').onclick = ()=>{
      state.stay = {...item, fee};
      document.querySelectorAll('#accommodation-list button').forEach(b=>b.disabled=false);
      div.querySelector('button').disabled = true;
      div.querySelector('button').textContent = 'Selected';
    };
    listDiv.appendChild(div);
  });
  nextStep(6);
}

/* ---------- STEP 7 – TRANSPORT ---------- */
function toggleTransport(val){
  const opts = document.getElementById('transport-options');
  opts.style.display = val==='yes'?'block':'none';
  if(val==='yes') loadTransport();
  else state.transport = [];
}
function loadTransport(){
  const div = document.getElementById('transport-options');
  div.innerHTML = '';
  const items = (MOCK.transport[state.parish]||[]).sort((a,b)=>b.priority-a.priority);
  items.forEach((t,idx)=>{
    const chk = document.createElement('div');
    chk.innerHTML = `<label><input type="checkbox" data-idx="${idx}"> ${t.name} – $${t.price}</label>`;
    chk.querySelector('input').onclick = (e)=>{
      if(e.target.checked) state.transport.push(t);
      else state.transport = state.transport.filter(x=>x.name!==t.name);
    };
    div.appendChild(chk);
  });
}

/* ---------- STEP 8 – TOURS ---------- */
document.getElementById('step8').querySelector('#tour-list').innerHTML = (()=>{
  const items = MOCK.tours[state.parish]||[];
  return items.map((t,idx)=>`
    <div class="item">
      <label><input type="checkbox" data-idx="${idx}"> ${t.name} – $${t.price}</label>
    </div>`).join('');
})();
document.querySelectorAll('#tour-list input[type=checkbox]').forEach(cb=>{
  cb.onclick = (e)=>{
    const t = MOCK.tours[state.parish][e.target.dataset.idx];
    if(e.target.checked) state.tours.push(t);
    else state.tours = state.tours.filter(x=>x.name!==t.name);
  };
});

/* ---------- SUMMARY RENDER ---------- */
function renderSummary(){
  const container = document.getElementById('package-items');
  container.innerHTML = '';
  let total = 0;

  const add = (label, price, fee=0)=>{
    total += price + fee;
    const div = document.createElement('div');
    div.className='item';
    div.innerHTML = `<span>${label}</span><span>$${price}${fee?` + <span class="fee">$${fee}</span>`:''}</span>`;
    container.appendChild(div);
  };

  if(state.stay){
    add(state.stay.name, state.stay.price, state.stay.fee);
  }
  state.transport.forEach(t=>add(t.name, t.price));
  state.tours.forEach(t=>add(t.name, t.price));

  document.getElementById('total').textContent = total.toFixed(2);
}

/* ---------- PAYMENT & SBT + QR ---------- */
function payNow(){
  const total = parseFloat(document.getElementById('total').textContent);
  if(total===0) return alert('Add something to your package first!');

  // ---- 1. SBT (background) ----
  const sbt = {
    id: Date.now(),
    user: 'YaadUser-'+Math.random().toString(36).substr(2,5),
    package: {
      from: state.from,
      arrive: state.arrive,
      parish: state.parish,
      stay: state.stay?.name,
      transport: state.transport.map(t=>t.name),
      tours: state.tours.map(t=>t.name),
      total
    },
    timestamp: new Date().toISOString(),
    type: 'SoulboundVacationToken'
  };
  console.log('SBT generated →', sbt);
  const blob = new Blob([JSON.stringify(sbt, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `yaadlife-sbt-${sbt.id}.json`;
  a.click();

  // ---- 2. QR codes for each booked item ----
  const qrArea = document.getElementById('qr-area');
  qrArea.innerHTML = '<h3>Scan to redeem</h3>';
  const items = [];
  if(state.stay) items.push(`Stay: ${state.stay.name}`);
  state.transport.forEach(t=>items.push(`Ride: ${t.name}`));
  state.tours.forEach(t=>items.push(`Tour: ${t.name}`));

  items.forEach(txt=>{
    const div = document.createElement('div');
    div.style = 'display:inline-block;margin:10px;text-align:center';
    const qr = document.createElement('div');
    new QRCode(qr, {text: txt, width:128, height:128});
    div.appendChild(qr);
    const cap = document.createElement('p');
    cap.textContent = txt;
    div.appendChild(cap);
    qrArea.appendChild(div);
  });

  function payNow(){
  const total = parseFloat(document.getElementById('total').textContent);
  if(total===0) return alert('Add something to your package first!');

  // ---- 1. SBT (background) ----
  const sbt = {
    id: Date.now(),
    user: 'YaadUser-'+Math.random().toString(36).substr(2,5),
    package: {
      from: state.from,
      arrive: state.arrive,
      parish: state.parish,
      stay: state.stay?.name,
      transport: state.transport.map(t=>t.name),
      tours: state.tours.map(t=>t.name),
      total
    },
    timestamp: new Date().toISOString(),
    type: 'SoulboundVacationToken'
  };
  console.log('SBT generated →', sbt);
  const blob = new Blob([JSON.stringify(sbt, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `yaadlife-sbt-${sbt.id}.json`;
  a.click();

  // ---- 2. QR codes for each booked item ----
  const qrArea = document.getElementById('qr-area');
  qrArea.innerHTML = '<h3>Scan to redeem</h3>';   // clear previous
  const items = [];
  if(state.stay) items.push(`Stay: ${state.stay.name}`);
  state.transport.forEach(t=>items.push(`Ride: ${t.name}`));
  state.tours.forEach(t=>items.push(`Tour: ${t.name}`));

  items.forEach(txt=>{
    const div = document.createElement('div');
    div.style = 'display:inline-block;margin:10px;text-align:center';
    const qr = document.createElement('div');
    new QRCode(qr, {text: txt, width:128, height:128});
    div.appendChild(qr);
    const cap = document.createElement('p');
    cap.textContent = txt;
    div.appendChild(cap);
    qrArea.appendChild(div);
  });

  alert('Payment simulated! SBT downloaded, QR codes ready.');
}
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
<script>
  // Test QR load
  window.addEventListener('load', function() {
    if (typeof QRCode !== 'undefined') {
      console.log('QRCode loaded!');
    } else {
      alert('QRCode library failed to load!');
    }
  });
</script>
  <script>
// EMBEDDED MOCK DATA (no separate file needed)
const MOCK = {
  accommodations: {
    kingston: [
      {name:"Rasta Road Villa", source:"Local", price:150, local:true, type:"coastal"},
      {name:"Harbor View Apt", source:"Airbnb", price:80, local:false, type:"coastal"},
      {name:"Kingston Roots GH", source:"Local", price:100, local:true, type:"inland"}
    ],
    "st-andrew": [
      {name:"Blue Mountain Cabin", source:"Local", price:200, local:true, type:"inland"}
    ],
    // Add other parishes here if needed (e.g., portland: [...])
  },
  transport: {
    kingston: [
      {name:"Lynk Airport → City", source:"Lynk", price:25, priority:true},
      {name:"JUTC Bus", source:"Public", price:2, priority:false}
    ]
    // Add more...
  },
  tours: {
    kingston: [
      {name:"Bob Marley Museum", price:30},
      {name:"Devon House Tour", price:20}
    ]
    // Add more...
  }
};
</script>

</body>
</html>
